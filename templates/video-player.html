<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logic and Stories | Video</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Pacifico&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Nunito', sans-serif; }
        .font-pacifico { font-family: 'Pacifico', cursive; }
        .gradient-text { background: linear-gradient(to right, #fde047, #fb923c); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    </style>
</head>
<body class="bg-slate-900 text-gray-200 flex flex-col min-h-screen">
    <script>
        if (!localStorage.getItem('userId')) { window.location.href = '/'; }
    </script>
    <header class="bg-slate-800 border-b border-slate-700">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="/" class="text-3xl font-pacifico gradient-text pb-1 leading-normal">Logic and Stories</a>
            <button id="mobile-menu-toggle" class="md:hidden text-gray-200 focus:outline-none">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
            </button>
            <div class="hidden md:flex items-center space-x-4">
                <a href="/dashboard.html" class="bg-gray-600 text-white font-bold py-2 px-5 rounded-full hover:bg-gray-500">Exit to Dashboard</a>
            </div>
        </nav>
        <div id="mobile-menu" class="md:hidden hidden px-6 pb-4">
            <a href="/dashboard.html" class="block py-2 hover:text-yellow-400">Exit to Dashboard</a>
        </div>
    </header>
    <main id="video-container" class="container mx-auto px-6 py-12 flex-grow flex flex-col justify-center items-center">
        <div id="loader" class="text-center">
            <h2 class="text-2xl font-bold">Loading your video...</h2>
        </div>
        <div id="video-content" class="w-full max-w-3xl hidden text-center">
            <h2 class="text-3xl font-bold mb-6 text-yellow-400">Lesson Video</h2>
            <div class="relative w-full" style="padding-top: 56.25%;">
                <iframe id="lesson-video" class="absolute top-0 left-0 w-full h-full rounded-2xl border border-slate-700" src="" allowfullscreen></iframe>
            </div>
            <div id="navigation-area" class="mt-8">
                <button id="back-to-dashboard-btn" class="bg-gray-600 text-white font-bold py-3 px-8 rounded-full text-lg hover:bg-gray-500">Back to Dashboard</button>
            </div>
        </div>
        <div id="error-display" class="text-center text-red-400 hidden"></div>
    </main>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
            const mobileMenu = document.getElementById('mobile-menu');
            const loader = document.getElementById('loader');
            const videoContent = document.getElementById('video-content');
            const errorDisplay = document.getElementById('error-display');
            const videoFrame = document.getElementById('lesson-video');
            const backBtn = document.getElementById('back-to-dashboard-btn');

            mobileMenuToggle.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });
            backBtn.addEventListener('click', () => {
                window.location.href = '/dashboard.html';
            });

            const params = new URLSearchParams(window.location.search);
            const topicId = params.get('topicId');
            if (!topicId) {
                loader.classList.add('hidden');
                errorDisplay.textContent = 'Invalid topic.';
                errorDisplay.classList.remove('hidden');
                return;
            }
            try {
                const resp = await fetch(`/api/video/${topicId}`);
                if (!resp.ok) {
                    throw new Error('Video not found');
                }
                const data = await resp.json();
                let url = data.videoUrl;
                if (url.includes('youtu.be')) {
                    const id = url.split('/').pop();
                    url = `https://www.youtube.com/embed/${id}`;
                } else if (url.includes('watch?v=')) {
                    url = url.replace('watch?v=', 'embed/');
                }
                videoFrame.src = url;
                loader.classList.add('hidden');
                videoContent.classList.remove('hidden');
            } catch (err) {
                loader.classList.add('hidden');
                errorDisplay.textContent = 'No video available for this topic.';
                errorDisplay.classList.remove('hidden');
            }
        });
    </script>
</body>
</html>
