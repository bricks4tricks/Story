<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logic and Stories | Enhanced Dashboard</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/static/favicon-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/static/favicon-512x512.png">
    <link rel="apple-touch-icon" href="/static/apple-touch-icon.png">
    
    <!-- Enhanced CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/static/css/mobile-enhancements.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Pacifico&display=swap" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --vh: 1vh;
        }
        
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            min-height: calc(var(--vh, 1vh) * 100);
        }
        
        .font-pacifico {
            font-family: 'Pacifico', cursive;
        }
        
        .gradient-text {
            background: linear-gradient(to right, #fde047, #fb923c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .glass-card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(148, 163, 184, 0.1);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .chart-container {
            position: relative;
            height: 300px;
        }
        
        .stats-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(16, 185, 129, 0.1));
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .stats-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(59, 130, 246, 0.2);
        }
        
        .achievement-badge {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin: 0 auto 12px;
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3);
        }
        
        .progress-ring {
            transform: rotate(-90deg);
        }
        
        .floating-elements {
            position: absolute;
            pointer-events: none;
            opacity: 0.1;
        }
        
        .floating-elements::before {
            content: 'üìö‚ú®üéØüìä';
            font-size: 60px;
            position: absolute;
            animation: float 20s infinite linear;
        }
        
        @keyframes float {
            0% { transform: translateY(100vh) rotate(0deg); }
            100% { transform: translateY(-100px) rotate(360deg); }
        }
        
        .quick-action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1rem;
        }
        
        .quick-action-card {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(6, 182, 212, 0.1));
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .quick-action-card:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.3);
        }
        
        .quick-action-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg);
            transition: all 0.5s;
            opacity: 0;
        }
        
        .quick-action-card:hover::before {
            animation: shimmer 0.8s ease-in-out;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); opacity: 0; }
        }
        
        .notification-dot {
            position: absolute;
            top: -4px;
            right: -4px;
            width: 12px;
            height: 12px;
            background: #ef4444;
            border-radius: 50%;
            border: 2px solid #0f172a;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.8; }
        }
        
        /* Mobile optimizations */
        @media (max-width: 768px) {
            .chart-container {
                height: 250px;
            }
            
            .quick-action-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* Dark theme optimizations */
        .light .glass-card {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .light .stats-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(16, 185, 129, 0.05));
            border: 1px solid rgba(59, 130, 246, 0.1);
        }
    </style>
</head>
<body class="bg-slate-900 text-white safe-area-inset-top">
    <!-- Floating background elements -->
    <div class="floating-elements"></div>
    
    <!-- Mobile navigation -->
    <nav class="mobile-nav-enhanced sticky top-0 z-50 px-4 py-3">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <h1 class="text-xl font-bold gradient-text">Logic & Stories</h1>
            </div>
            
            <div class="flex items-center space-x-4">
                <!-- Notifications -->
                <button class="relative p-2 hover:bg-slate-700 rounded-lg touch-target">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5-5-5h5zm0 0V9a6 6 0 1012 0v8zm0 0H9m6 0V9"></path>
                    </svg>
                    <div class="notification-dot"></div>
                </button>
                
                <!-- Menu toggle -->
                <button id="mobile-menu-toggle" class="mobile-menu-button touch-target md:hidden">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
        </div>
    </nav>
    
    <!-- Mobile menu overlay -->
    <div id="mobile-menu-overlay" class="mobile-menu-overlay">
        <div class="mobile-menu-panel safe-area-inset-top">
            <div class="p-6">
                <div class="flex items-center justify-between mb-8">
                    <h2 class="text-xl font-bold">Menu</h2>
                    <button id="close-mobile-menu" class="touch-target">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <nav class="space-y-4">
                    <a href="/dashboard.html" class="flex items-center space-x-3 p-3 rounded-lg bg-blue-600">
                        <span class="text-xl">üìä</span>
                        <span>Dashboard</span>
                    </a>
                    <a href="/story-player.html" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-slate-700">
                        <span class="text-xl">üìñ</span>
                        <span>Stories</span>
                    </a>
                    <a href="/quiz-player.html" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-slate-700">
                        <span class="text-xl">üß†</span>
                        <span>Quizzes</span>
                    </a>
                    <a href="/progress-dashboard.html" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-slate-700">
                        <span class="text-xl">üìà</span>
                        <span>Progress</span>
                    </a>
                    <a href="/leaderboard.html" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-slate-700">
                        <span class="text-xl">üèÜ</span>
                        <span>Leaderboard</span>
                    </a>
                    <a href="/settings.html" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-slate-700">
                        <span class="text-xl">‚öôÔ∏è</span>
                        <span>Settings</span>
                    </a>
                </nav>
            </div>
        </div>
    </div>
    
    <!-- Main content -->
    <div class="container mx-auto px-4 py-6 safe-area-inset-bottom">
        <!-- Welcome section with gamification -->
        <div class="glass-card p-6 mb-6">
            <div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-4">
                <div>
                    <h2 class="text-2xl md:text-3xl font-bold mb-2">Welcome back! üëã</h2>
                    <p class="text-slate-400">Ready to continue your learning adventure?</p>
                </div>
                
                <!-- Gamification progress -->
                <div id="gamification-progress" class="mt-4 md:mt-0">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </div>
        
        <!-- Quick stats -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6 stats-grid">
            <div class="stats-card">
                <div class="text-2xl mb-2">üìö</div>
                <div class="text-2xl font-bold text-blue-400" id="stories-read">0</div>
                <div class="text-sm text-slate-400">Stories Read</div>
            </div>
            
            <div class="stats-card">
                <div class="text-2xl mb-2">üß†</div>
                <div class="text-2xl font-bold text-green-400" id="quizzes-completed">0</div>
                <div class="text-sm text-slate-400">Quizzes Done</div>
            </div>
            
            <div class="stats-card">
                <div class="text-2xl mb-2">üî•</div>
                <div class="text-2xl font-bold text-orange-400" id="current-streak">0</div>
                <div class="text-sm text-slate-400">Day Streak</div>
            </div>
            
            <div class="stats-card">
                <div class="text-2xl mb-2">‚≠ê</div>
                <div class="text-2xl font-bold text-yellow-400" id="total-points">0</div>
                <div class="text-sm text-slate-400">Points</div>
            </div>
        </div>
        
        <!-- Quick actions -->
        <div class="glass-card p-6 mb-6">
            <h3 class="text-xl font-bold mb-4">Quick Actions</h3>
            <div class="quick-action-grid">
                <div class="quick-action-card mobile-card" onclick="navigateToStories()">
                    <div class="text-3xl mb-2">üìñ</div>
                    <div class="font-semibold">Read Story</div>
                    <div class="text-xs text-slate-400 mt-1">Continue learning</div>
                </div>
                
                <div class="quick-action-card mobile-card" onclick="navigateToQuiz()">
                    <div class="text-3xl mb-2">üß†</div>
                    <div class="font-semibold">Take Quiz</div>
                    <div class="text-xs text-slate-400 mt-1">Test knowledge</div>
                </div>
                
                <div class="quick-action-card mobile-card" onclick="navigateToProgress()">
                    <div class="text-3xl mb-2">üìà</div>
                    <div class="font-semibold">View Progress</div>
                    <div class="text-xs text-slate-400 mt-1">Track growth</div>
                </div>
                
                <div class="quick-action-card mobile-card" onclick="navigateToLeaderboard()">
                    <div class="text-3xl mb-2">üèÜ</div>
                    <div class="font-semibold">Leaderboard</div>
                    <div class="text-xs text-slate-400 mt-1">Compare scores</div>
                </div>
            </div>
        </div>
        
        <!-- Progress charts section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <!-- Weekly progress chart -->
            <div class="glass-card p-6">
                <h3 class="text-xl font-bold mb-4">üìà Weekly Progress</h3>
                <div class="chart-container">
                    <canvas id="weeklyProgressChart"></canvas>
                </div>
            </div>
            
            <!-- Subject performance -->
            <div class="glass-card p-6">
                <h3 class="text-xl font-bold mb-4">üìä Subject Performance</h3>
                <div class="chart-container">
                    <canvas id="subjectPerformanceChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Reading streak and accuracy -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <!-- Reading streak -->
            <div class="glass-card p-6">
                <h3 class="text-xl font-bold mb-4">üî• Reading Streak</h3>
                <div class="chart-container">
                    <canvas id="streakChart"></canvas>
                </div>
            </div>
            
            <!-- Quiz accuracy trend -->
            <div class="glass-card p-6">
                <h3 class="text-xl font-bold mb-4">üéØ Quiz Accuracy</h3>
                <div class="chart-container">
                    <canvas id="accuracyTrendChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Badges and achievements -->
        <div class="glass-card p-6 mb-6">
            <h3 class="text-xl font-bold mb-4">üèÜ Achievements</h3>
            <div id="badges-container">
                <!-- Populated by JavaScript -->
            </div>
        </div>
        
        <!-- Recent activity -->
        <div class="glass-card p-6">
            <h3 class="text-xl font-bold mb-4">üìù Recent Activity</h3>
            <div id="recent-activity" class="space-y-3">
                <!-- Populated by JavaScript -->
            </div>
        </div>
    </div>
    
    <!-- Floating action button -->
    <button class="fab" onclick="startQuickLearning()" aria-label="Start quick learning session">
        ‚ö°
    </button>
    
    <!-- Bottom sheet for actions -->
    <div id="bottom-sheet" class="bottom-sheet">
        <div class="bottom-sheet-handle"></div>
        <div id="bottom-sheet-content" class="p-6">
            <!-- Content loaded dynamically -->
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="/static/js/secureDOM.js"></script>
    <script src="/static/js/csrf.js"></script>
    <script src="/static/js/mobileEnhancements.js"></script>
    <script src="/static/js/progressCharts.js"></script>
    <script src="/static/js/gamification.js"></script>
    <script src="/static/js/preferences.js"></script>
    
    <script>
        // Enhanced dashboard functionality
        class EnhancedDashboard {
            constructor() {
                this.isLoading = false;
                this.refreshInterval = null;
                this.init();
            }
            
            async init() {
                await this.loadDashboardData();
                this.setupEventListeners();
                this.setupAutoRefresh();
                this.setupPullToRefresh();
                this.checkForUpdates();
            }
            
            async loadDashboardData() {
                if (this.isLoading) return;
                this.isLoading = true;
                
                try {
                    // Load user stats
                    await this.loadUserStats();
                    
                    // Load recent activity
                    await this.loadRecentActivity();
                    
                    // Initialize charts and gamification
                    if (window.progressCharts) {
                        await window.progressCharts.initializeCharts();
                    }
                    
                    if (window.gamificationSystem) {
                        await window.gamificationSystem.initialize();
                    }
                    
                } catch (error) {
                    console.error('Error loading dashboard data:', error);
                    this.showErrorToast('Failed to load dashboard data');
                } finally {
                    this.isLoading = false;
                }
            }
            
            async loadUserStats() {
                try {
                    const response = await csrfManager.get('/api/progress/analytics');
                    if (response.ok) {
                        const data = await response.json();
                        this.updateStatsDisplay(data);
                    }
                } catch (error) {
                    console.error('Error loading user stats:', error);
                }
            }
            
            updateStatsDisplay(data) {
                // Update stats cards with animation
                this.animateCounter('stories-read', data.totalStories || 0);
                this.animateCounter('quizzes-completed', data.totalQuizzes || 0);
                this.animateCounter('current-streak', data.currentStreak || 0);
                this.animateCounter('total-points', data.totalPoints || 0);
            }
            
            animateCounter(elementId, targetValue) {
                const element = document.getElementById(elementId);
                if (!element) return;
                
                const startValue = parseInt(element.textContent) || 0;
                const duration = 1000;
                const startTime = Date.now();
                
                const animate = () => {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    
                    const easeOutQuart = 1 - Math.pow(1 - progress, 4);
                    const currentValue = Math.floor(startValue + (targetValue - startValue) * easeOutQuart);
                    
                    element.textContent = currentValue;
                    
                    if (progress < 1) {
                        requestAnimationFrame(animate);
                    }
                };
                
                animate();
            }
            
            async loadRecentActivity() {
                try {
                    const container = document.getElementById('recent-activity');
                    if (!container) return;
                    
                    SecureDOM.setLoadingState(container, 'Loading recent activity...');
                    
                    const response = await csrfManager.get('/api/activity/recent');
                    if (response.ok) {
                        const activities = await response.json();
                        this.displayRecentActivity(activities);
                    } else {
                        SecureDOM.setEmptyState(container, 'No recent activity');
                    }
                } catch (error) {
                    console.error('Error loading recent activity:', error);
                    const container = document.getElementById('recent-activity');
                    if (container) {
                        SecureDOM.setErrorState(container, 'Failed to load activity');
                    }
                }
            }
            
            displayRecentActivity(activities) {
                const container = document.getElementById('recent-activity');
                if (!container) return;
                
                SecureDOM.replaceContent(container);
                
                if (activities.length === 0) {
                    SecureDOM.setEmptyState(container, 'No recent activity');
                    return;
                }
                
                activities.forEach(activity => {
                    const activityCard = this.createActivityCard(activity);
                    container.appendChild(activityCard);
                });
            }
            
            createActivityCard(activity) {
                const card = SecureDOM.createElement('div', {
                    className: 'flex items-center space-x-3 p-3 rounded-lg bg-slate-800/50 hover:bg-slate-700/50 transition-colors'
                });
                
                const icon = SecureDOM.createElement('div', {
                    className: 'text-2xl flex-shrink-0'
                }, this.getActivityIcon(activity.type));
                
                const content = SecureDOM.createElement('div', {
                    className: 'flex-1'
                });
                
                const title = SecureDOM.createElement('div', {
                    className: 'font-semibold text-white'
                }, activity.title);
                
                const description = SecureDOM.createElement('div', {
                    className: 'text-sm text-slate-400'
                }, activity.description);
                
                const time = SecureDOM.createElement('div', {
                    className: 'text-xs text-slate-500 mt-1'
                }, this.formatTimeAgo(activity.timestamp));
                
                SecureDOM.appendContent(content, title, description, time);
                SecureDOM.appendContent(card, icon, content);
                
                return card;
            }
            
            getActivityIcon(type) {
                const icons = {
                    'story_read': 'üìñ',
                    'quiz_completed': 'üß†',
                    'badge_earned': 'üèÜ',
                    'level_up': '‚¨ÜÔ∏è',
                    'streak_updated': 'üî•'
                };
                return icons[type] || 'üìù';
            }
            
            formatTimeAgo(timestamp) {
                const now = new Date();
                const time = new Date(timestamp);
                const diffInMinutes = Math.floor((now - time) / (1000 * 60));
                
                if (diffInMinutes < 1) return 'Just now';
                if (diffInMinutes < 60) return `${diffInMinutes}m ago`;
                if (diffInMinutes < 1440) return `${Math.floor(diffInMinutes / 60)}h ago`;
                return `${Math.floor(diffInMinutes / 1440)}d ago`;
            }
            
            setupEventListeners() {
                // Mobile menu
                const menuToggle = document.getElementById('mobile-menu-toggle');
                const menuOverlay = document.getElementById('mobile-menu-overlay');
                const closeMenu = document.getElementById('close-mobile-menu');
                
                menuToggle?.addEventListener('click', () => {
                    menuOverlay.classList.add('active');
                    menuOverlay.querySelector('.mobile-menu-panel').classList.add('active');
                });
                
                closeMenu?.addEventListener('click', () => {
                    this.closeMobileMenu();
                });
                
                menuOverlay?.addEventListener('click', (e) => {
                    if (e.target === menuOverlay) {
                        this.closeMobileMenu();
                    }
                });
                
                // Pull to refresh
                document.addEventListener('pullRefresh', () => {
                    this.handlePullRefresh();
                });
                
                // Swipe navigation
                document.addEventListener('swipe', (e) => {
                    this.handleSwipeNavigation(e.detail);
                });
            }
            
            closeMobileMenu() {
                const menuOverlay = document.getElementById('mobile-menu-overlay');
                const menuPanel = menuOverlay?.querySelector('.mobile-menu-panel');
                
                menuPanel?.classList.remove('active');
                SecureDOM.safeTimeout(() => {
                    menuOverlay?.classList.remove('active');
                }, 300);
            }
            
            async handlePullRefresh() {
                await this.loadDashboardData();
                
                if (window.mobileEnhancements) {
                    window.mobileEnhancements.showToast('Dashboard refreshed!', 2000, 'success');
                }
            }
            
            handleSwipeNavigation(swipeData) {
                const { direction } = swipeData;
                
                if (direction === 'left') {
                    // Swipe left to go to next section
                    this.navigateToNext();
                } else if (direction === 'right') {
                    // Swipe right to go back
                    if (window.history.length > 1) {
                        window.history.back();
                    }
                }
            }
            
            navigateToNext() {
                // Cycle through main sections
                const sections = ['/story-player.html', '/quiz-player.html', '/progress-dashboard.html'];
                const currentPath = window.location.pathname;
                const currentIndex = sections.indexOf(currentPath);
                const nextIndex = (currentIndex + 1) % sections.length;
                
                window.location.href = sections[nextIndex];
            }
            
            setupAutoRefresh() {
                // Refresh dashboard data every 5 minutes
                this.refreshInterval = setInterval(() => {
                    this.loadDashboardData();
                }, 5 * 60 * 1000);
            }
            
            setupPullToRefresh() {
                // Enhanced pull-to-refresh for dashboard
                let startY = 0;
                let isPulling = false;
                
                document.addEventListener('touchstart', (e) => {
                    if (window.scrollY === 0) {
                        startY = e.touches[0].clientY;
                    }
                }, { passive: true });
                
                document.addEventListener('touchmove', (e) => {
                    if (window.scrollY === 0 && startY) {
                        const currentY = e.touches[0].clientY;
                        const pullDistance = currentY - startY;
                        
                        if (pullDistance > 0) {
                            isPulling = true;
                            // Visual feedback could be added here
                        }
                    }
                }, { passive: true });
                
                document.addEventListener('touchend', () => {
                    if (isPulling) {
                        this.handlePullRefresh();
                        isPulling = false;
                        startY = 0;
                    }
                }, { passive: true });
            }
            
            checkForUpdates() {
                // Check for new achievements, notifications, etc.
                setInterval(async () => {
                    try {
                        const response = await csrfManager.get('/api/notifications/check');
                        if (response.ok) {
                            const data = await response.json();
                            
                            if (data.hasNewAchievements) {
                                this.showNewAchievementNotification();
                            }
                            
                            if (data.hasNewMessages) {
                                this.updateNotificationBadge(data.messageCount);
                            }
                        }
                    } catch (error) {
                        console.error('Error checking for updates:', error);
                    }
                }, 30000); // Check every 30 seconds
            }
            
            showNewAchievementNotification() {
                if (window.mobileEnhancements) {
                    window.mobileEnhancements.showToast('üèÜ New achievement unlocked!', 3000, 'success');
                }
            }
            
            updateNotificationBadge(count) {
                const badge = document.querySelector('.notification-dot');
                if (badge && count > 0) {
                    badge.style.display = 'block';
                } else if (badge && count === 0) {
                    badge.style.display = 'none';
                }
            }
            
            showErrorToast(message) {
                if (window.mobileEnhancements) {
                    window.mobileEnhancements.showToast(message, 3000, 'error');
                }
            }
            
            destroy() {
                if (this.refreshInterval) {
                    clearInterval(this.refreshInterval);
                }
            }
        }
        
        // Navigation functions
        function navigateToStories() {
            window.location.href = '/story-player.html';
        }
        
        function navigateToQuiz() {
            window.location.href = '/quiz-player.html';
        }
        
        function navigateToProgress() {
            window.location.href = '/progress-dashboard.html';
        }
        
        function navigateToLeaderboard() {
            window.location.href = '/leaderboard.html';
        }
        
        function startQuickLearning() {
            // Show bottom sheet with quick learning options
            const content = SecureDOM.createElement('div');
            
            const title = SecureDOM.createElement('h3', {
                className: 'text-xl font-bold mb-4 text-center'
            }, '‚ö° Quick Learning');
            
            const options = [
                { icon: 'üìñ', title: '5-Minute Story', action: 'quick-story' },
                { icon: 'üß†', title: 'Quick Quiz', action: 'quick-quiz' },
                { icon: 'üéØ', title: 'Daily Challenge', action: 'daily-challenge' }
            ];
            
            const optionsContainer = SecureDOM.createElement('div', {
                className: 'space-y-3'
            });
            
            options.forEach(option => {
                const button = SecureDOM.createElement('button', {
                    className: 'w-full flex items-center space-x-4 p-4 rounded-lg bg-slate-700 hover:bg-slate-600 transition-colors'
                });
                
                const icon = SecureDOM.createElement('span', {
                    className: 'text-2xl'
                }, option.icon);
                
                const text = SecureDOM.createElement('span', {
                    className: 'font-semibold'
                }, option.title);
                
                button.addEventListener('click', () => {
                    handleQuickAction(option.action);
                    window.mobileEnhancements?.hideBottomSheet();
                });
                
                SecureDOM.appendContent(button, icon, text);
                optionsContainer.appendChild(button);
            });
            
            SecureDOM.appendContent(content, title, optionsContainer);
            window.mobileEnhancements?.showBottomSheet(content);
        }
        
        function handleQuickAction(action) {
            switch (action) {
                case 'quick-story':
                    window.location.href = '/story-player.html?mode=quick';
                    break;
                case 'quick-quiz':
                    window.location.href = '/quiz-player.html?mode=quick';
                    break;
                case 'daily-challenge':
                    window.location.href = '/quiz-player.html?mode=daily';
                    break;
            }
        }
        
        // Initialize enhanced dashboard
        document.addEventListener('DOMContentLoaded', () => {
            window.enhancedDashboard = new EnhancedDashboard();
        });
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (window.enhancedDashboard) {
                window.enhancedDashboard.destroy();
            }
        });
    </script>
</body>
</html>