<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Leaderboard</title>
    <link href="/static/css/styles.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Nunito', sans-serif; }
        /* Styles for the modal */
        .modal-hidden {
            display: none !important; /* Ensures modals are hidden correctly */
        }
        .modal {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease;
        }
    </style>
</head>
<body class="bg-slate-900 text-gray-200">
    <main class="container mx-auto px-6 py-12">
        <h1 class="text-4xl font-bold text-white mb-6">Quiz Leaderboard</h1>
        <div id="board"></div>
    </main>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const resp = await fetch(`${window.location.origin}/api/leaderboard`);
                if (!resp.ok) throw new Error('Failed to fetch leaderboard');
                const data = await resp.json();
                renderLeaderboard(data);
            } catch (err) {
                // Secure XSS-safe error display
                const boardElement = document.getElementById('board');
                const errorP = document.createElement('p');
                errorP.className = 'text-red-400';
                errorP.textContent = err.message;
                boardElement.appendChild(errorP);
            }
        });

        function renderLeaderboard(data) {
            const boardElement = document.getElementById('board');
            boardElement.innerHTML = ''; // Clear previous content
            
            if (!data.length) {
                const noDataP = document.createElement('p');
                noDataP.textContent = 'No quiz scores yet.';
                boardElement.appendChild(noDataP);
                return;
            }
            
            // Secure table creation without innerHTML
            const table = document.createElement('table');
            table.className = 'table-auto text-left';
            
            // Create header
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            ['Rank', 'User', 'Avg Score', 'Attempts'].forEach(headerText => {
                const th = document.createElement('th');
                th.className = 'px-4 py-2';
                th.textContent = headerText;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);
            
            // Create body
            const tbody = document.createElement('tbody');
            data.forEach((r, i) => {
                const row = document.createElement('tr');
                
                // Rank cell
                const rankCell = document.createElement('td');
                rankCell.className = 'border px-4 py-2';
                rankCell.textContent = (i + 1).toString();
                row.appendChild(rankCell);
                
                // Username cell (sanitized)
                const usernameCell = document.createElement('td');
                usernameCell.className = 'border px-4 py-2';
                usernameCell.textContent = r.username || '';
                row.appendChild(usernameCell);
                
                // Average score cell
                const scoreCell = document.createElement('td');
                scoreCell.className = 'border px-4 py-2';
                scoreCell.textContent = r.average_score || '';
                row.appendChild(scoreCell);
                
                // Attempts cell
                const attemptsCell = document.createElement('td');
                attemptsCell.className = 'border px-4 py-2';
                attemptsCell.textContent = r.attempts || '';
                row.appendChild(attemptsCell);
                
                tbody.appendChild(row);
            });
            
            table.appendChild(tbody);
            boardElement.appendChild(table);
        }
    </script>
</body>
</html>
