<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Gap Analysis - Visual Diagrams</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        h1, h2 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            font-size: 1.1em;
            margin-bottom: 40px;
        }
        
        .diagram-section {
            margin-bottom: 60px;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .flow-diagram { background: linear-gradient(45deg, #ff9a9e 0%, #fecfef 100%); }
        .mind-map { background: linear-gradient(45deg, #a8edea 0%, #fed6e3 100%); }
        .bubble-map { background: linear-gradient(45deg, #ffecd2 0%, #fcb69f 100%); }
        .heat-map { background: linear-gradient(45deg, #667eea 0%, #764ba2 100%); }
        
        .mermaid {
            text-align: center;
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .gap-legend {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
        }
        
        .gap-item {
            display: flex;
            align-items: center;
            background: white;
            padding: 8px 15px;
            border-radius: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .gap-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
        }
        
        .critical { background: #e74c3c; }
        .high { background: #e67e22; }
        .medium { background: #f39c12; }
        .low { background: #27ae60; }
        .secure { background: #2ecc71; }
        
        #bubble-container, #heat-container {
            background: white;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .tooltip {
            position: absolute;
            padding: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            border-radius: 5px;
            pointer-events: none;
            font-size: 12px;
            z-index: 1000;
        }
        
        .analysis-summary {
            background: linear-gradient(45deg, #ee9ca7 0%, #ffdde1 100%);
            padding: 25px;
            border-radius: 10px;
            margin-top: 40px;
        }
        
        .gap-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stat-label {
            color: #7f8c8d;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Security Gap Analysis</h1>
        <p class="subtitle">Comprehensive Visual Analysis of Code and Website Security Gaps</p>
        
        <div class="gap-legend">
            <div class="gap-item">
                <div class="gap-color critical"></div>
                <span>Critical Gap</span>
            </div>
            <div class="gap-item">
                <div class="gap-color high"></div>
                <span>High Risk</span>
            </div>
            <div class="gap-item">
                <div class="gap-color medium"></div>
                <span>Medium Risk</span>
            </div>
            <div class="gap-item">
                <div class="gap-color low"></div>
                <span>Low Risk</span>
            </div>
            <div class="gap-item">
                <div class="gap-color secure"></div>
                <span>Secure</span>
            </div>
        </div>

        <!-- Flow Diagram -->
        <div class="diagram-section flow-diagram">
            <h2>üîÑ Security Flow Diagram - Attack Surface Analysis</h2>
            <div class="mermaid">
                flowchart TD
                    A[üë§ User Request] --> B{Authentication Required?}
                    B -->|Yes| C[üîê Auth Check]
                    B -->|No| D[üìù Input Validation]
                    
                    C --> C1{Valid Session?}
                    C1 -->|No| C2[‚ùå 401 Unauthorized]
                    C1 -->|Yes| C3[‚úÖ Session Valid]
                    C3 --> D
                    
                    D --> D1{Input Safe?}
                    D1 -->|No| D2[üö´ 400 Bad Request]
                    D1 -->|Yes| E[üõ°Ô∏è CSRF Check]
                    
                    E --> E1{CSRF Valid?}
                    E1 -->|No| E2[‚ö†Ô∏è 403 Forbidden]
                    E1 -->|Yes| F[üìä Rate Limit Check]
                    
                    F --> F1{Within Limits?}
                    F1 -->|No| F2[üö® 429 Rate Limited]
                    F1 -->|Yes| G[üíæ Database Operation]
                    
                    G --> G1{SQL Safe?}
                    G1 -->|No| G2[üí• SQL Injection Risk]
                    G1 -->|Yes| H[üì§ Response Generation]
                    
                    H --> H1{Output Safe?}
                    H1 -->|No| H2[‚ö° XSS Risk]
                    H1 -->|Yes| I[‚úÖ Secure Response]
                    
                    classDef critical fill:#e74c3c,stroke:#c0392b,color:#fff
                    classDef high fill:#e67e22,stroke:#d35400,color:#fff
                    classDef medium fill:#f39c12,stroke:#e67e22,color:#fff
                    classDef secure fill:#27ae60,stroke:#229954,color:#fff
                    
                    class C2,D2,E2,F2,G2,H2 critical
                    class C1,D1,E1,F1,G1,H1 high
                    class C,D,E,F,G,H medium
                    class C3,I secure
            </div>
        </div>

        <!-- Mind Map -->
        <div class="diagram-section mind-map">
            <h2>üß† Security Mind Map - Vulnerability Categories</h2>
            <div class="mermaid">
                mindmap
                    root((üõ°Ô∏è Security Gaps))
                        üîç Input Validation
                            XSS Prevention
                                Template Rendering ‚úÖ
                                User Input Sanitization ‚úÖ
                                URL Parameter Validation ‚ö†Ô∏è
                            SQL Injection
                                Parameterized Queries ‚úÖ
                                Dynamic Query Building ‚ö†Ô∏è
                                Stored Procedures ‚ùå
                            File Upload Validation ‚úÖ
                                MIME Type Checking ‚úÖ
                                File Size Limits ‚úÖ
                                Malicious Content Scan ‚úÖ
                        
                        üîê Authentication
                            Session Management ‚úÖ
                                Token Generation ‚úÖ
                                Session Timeout ‚ö†Ô∏è
                                Session Fixation ‚ùå
                            Password Security ‚úÖ
                                Strong Password Policy ‚úÖ
                                Password Hashing ‚úÖ
                                Account Lockout ‚ùå
                            Multi-Factor Auth ‚ùå
                        
                        üõ°Ô∏è Authorization
                            Role-Based Access ‚úÖ
                                Admin Protection ‚úÖ
                                User Permissions ‚ö†Ô∏è
                                Resource Access Control ‚ö†Ô∏è
                            API Security ‚úÖ
                                Endpoint Protection ‚úÖ
                                Rate Limiting ‚úÖ
                                CORS Configuration ‚ö†Ô∏è
                        
                        üîí Data Protection
                            Encryption
                                Data at Rest ‚ö†Ô∏è
                                Data in Transit ‚úÖ
                                Sensitive Data Handling ‚ö†Ô∏è
                            Privacy
                                PII Protection ‚ö†Ô∏è
                                Data Retention ‚ùå
                                GDPR Compliance ‚ùå
                        
                        üåê Infrastructure
                            Server Security
                                Security Headers ‚úÖ
                                HTTPS Configuration ‚úÖ
                                Server Hardening ‚ö†Ô∏è
                            Database Security
                                Connection Security ‚úÖ
                                Backup Encryption ‚ùå
                                Access Logging ‚ùå
                            
                        üìä Monitoring
                            Security Logging ‚ùå
                            Intrusion Detection ‚ùå
                            Vulnerability Scanning ‚ö†Ô∏è
            </div>
        </div>

        <!-- Bubble Map -->
        <div class="diagram-section bubble-map">
            <h2>ü´ß Component Security Bubble Map</h2>
            <div id="bubble-container"></div>
        </div>

        <!-- Heat Map -->
        <div class="diagram-section heat-map">
            <h2>üî• Security Risk Heat Map</h2>
            <div id="heat-container"></div>
        </div>

        <!-- Analysis Summary -->
        <div class="analysis-summary">
            <h2>üìä Gap Analysis Summary</h2>
            <div class="gap-stats">
                <div class="stat-card">
                    <div class="stat-number critical">3</div>
                    <div class="stat-label">Critical Gaps</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number high">5</div>
                    <div class="stat-label">High Risk Areas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number medium">8</div>
                    <div class="stat-label">Medium Risk Items</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number secure">12</div>
                    <div class="stat-label">Secure Components</div>
                </div>
            </div>
            
            <h3>üö® Critical Gaps Requiring Immediate Attention:</h3>
            <ul>
                <li><strong>Multi-Factor Authentication:</strong> Not implemented for admin accounts</li>
                <li><strong>Security Logging & Monitoring:</strong> Limited security event tracking</li>
                <li><strong>Data Encryption at Rest:</strong> Database encryption not configured</li>
            </ul>
            
            <h3>‚ö†Ô∏è High Priority Improvements:</h3>
            <ul>
                <li><strong>Account Lockout Policy:</strong> No protection against brute force attacks</li>
                <li><strong>Session Fixation Protection:</strong> Session tokens not rotated on login</li>
                <li><strong>URL Parameter Validation:</strong> Direct object references not validated</li>
                <li><strong>CORS Configuration:</strong> May be too permissive</li>
                <li><strong>Server Hardening:</strong> Additional security configurations needed</li>
            </ul>
        </div>
    </div>

    <script>
        // Initialize Mermaid
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                fontFamily: 'Segoe UI, sans-serif'
            }
        });

        // Create Bubble Map
        function createBubbleMap() {
            const width = 800;
            const height = 600;
            
            const data = {
                children: [
                    // Critical Gaps (Red)
                    { name: "Multi-Factor Auth", value: 100, risk: "critical", description: "MFA not implemented" },
                    { name: "Security Logging", value: 90, risk: "critical", description: "Limited security event logging" },
                    { name: "Data Encryption", value: 85, risk: "critical", description: "Database encryption missing" },
                    
                    // High Risk (Orange)
                    { name: "Account Lockout", value: 80, risk: "high", description: "No brute force protection" },
                    { name: "Session Fixation", value: 75, risk: "high", description: "Session tokens not rotated" },
                    { name: "URL Validation", value: 70, risk: "high", description: "Direct object reference gaps" },
                    { name: "CORS Config", value: 65, risk: "high", description: "Potentially permissive CORS" },
                    { name: "Server Hardening", value: 60, risk: "high", description: "Additional hardening needed" },
                    
                    // Medium Risk (Yellow)
                    { name: "PII Protection", value: 55, risk: "medium", description: "Privacy controls needed" },
                    { name: "User Permissions", value: 50, risk: "medium", description: "Granular permissions missing" },
                    { name: "Resource Access", value: 45, risk: "medium", description: "Access control improvements" },
                    { name: "Session Timeout", value: 40, risk: "medium", description: "Timeout policies unclear" },
                    { name: "Dynamic Queries", value: 35, risk: "medium", description: "Some dynamic SQL usage" },
                    { name: "Sensitive Data", value: 30, risk: "medium", description: "Data handling improvements" },
                    { name: "Vulnerability Scan", value: 25, risk: "medium", description: "Automated scanning missing" },
                    { name: "Data at Rest", value: 20, risk: "medium", description: "Encryption improvements needed" },
                    
                    // Secure Components (Green)
                    { name: "XSS Prevention", value: 15, risk: "secure", description: "Fixed all XSS vulnerabilities" },
                    { name: "Input Validation", value: 15, risk: "secure", description: "Comprehensive validation added" },
                    { name: "File Upload Security", value: 15, risk: "secure", description: "Secure file handling implemented" },
                    { name: "CSRF Protection", value: 15, risk: "secure", description: "CSRF tokens on critical endpoints" },
                    { name: "Rate Limiting", value: 15, risk: "secure", description: "Rate limits on all endpoints" },
                    { name: "SQL Injection", value: 15, risk: "secure", description: "Parameterized queries used" },
                    { name: "Authentication", value: 15, risk: "secure", description: "Secure auth implementation" },
                    { name: "Password Security", value: 15, risk: "secure", description: "Strong password policies" },
                    { name: "Session Management", value: 15, risk: "secure", description: "Secure session handling" },
                    { name: "Security Headers", value: 15, risk: "secure", description: "Comprehensive headers added" },
                    { name: "HTTPS Config", value: 15, risk: "secure", description: "Proper HTTPS setup" },
                    { name: "Admin Protection", value: 15, risk: "secure", description: "Admin endpoints secured" }
                ]
            };

            const svg = d3.select("#bubble-container")
                .append("svg")
                .attr("width", width)
                .attr("height", height);

            const color = d3.scaleOrdinal()
                .domain(["critical", "high", "medium", "secure"])
                .range(["#e74c3c", "#e67e22", "#f39c12", "#27ae60"]);

            const pack = d3.pack()
                .size([width, height])
                .padding(3);

            const root = d3.hierarchy({ children: data.children })
                .sum(d => d.value);

            const nodes = pack(root).leaves();

            const tooltip = d3.select("body")
                .append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);

            const bubble = svg.selectAll(".bubble")
                .data(nodes)
                .enter().append("g")
                .attr("class", "bubble")
                .attr("transform", d => `translate(${d.x},${d.y})`);

            bubble.append("circle")
                .attr("r", d => d.r)
                .style("fill", d => color(d.data.risk))
                .style("opacity", 0.8)
                .style("stroke", d => d3.color(color(d.data.risk)).darker())
                .style("stroke-width", 2)
                .on("mouseover", function(event, d) {
                    d3.select(this).style("opacity", 1);
                    tooltip.transition()
                        .duration(200)
                        .style("opacity", .9);
                    tooltip.html(`<strong>${d.data.name}</strong><br/>${d.data.description}`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function(d) {
                    d3.select(this).style("opacity", 0.8);
                    tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
                });

            bubble.append("text")
                .attr("dy", ".3em")
                .style("text-anchor", "middle")
                .style("font-size", d => Math.min(d.r / 4, 14) + "px")
                .style("fill", "white")
                .style("font-weight", "bold")
                .text(d => d.data.name.length > 12 ? d.data.name.substring(0, 12) + "..." : d.data.name);
        }

        // Create Heat Map
        function createHeatMap() {
            const margin = { top: 50, right: 50, bottom: 100, left: 150 };
            const width = 800 - margin.left - margin.right;
            const height = 500 - margin.top - margin.bottom;

            const data = [
                // Components vs Security Aspects
                { component: "Authentication", aspect: "Input Validation", risk: 2 },
                { component: "Authentication", aspect: "Session Security", risk: 2 },
                { component: "Authentication", aspect: "Rate Limiting", risk: 2 },
                { component: "Authentication", aspect: "MFA", risk: 5 },
                { component: "Authentication", aspect: "Account Lockout", risk: 4 },
                
                { component: "File Upload", aspect: "Input Validation", risk: 2 },
                { component: "File Upload", aspect: "Content Scanning", risk: 2 },
                { component: "File Upload", aspect: "Size Limits", risk: 2 },
                { component: "File Upload", aspect: "Type Validation", risk: 2 },
                { component: "File Upload", aspect: "Malware Scan", risk: 3 },
                
                { component: "Templates", aspect: "XSS Prevention", risk: 2 },
                { component: "Templates", aspect: "Output Encoding", risk: 2 },
                { component: "Templates", aspect: "CSP Headers", risk: 3 },
                { component: "Templates", aspect: "Content Security", risk: 2 },
                { component: "Templates", aspect: "Script Injection", risk: 2 },
                
                { component: "Database", aspect: "SQL Injection", risk: 2 },
                { component: "Database", aspect: "Connection Security", risk: 2 },
                { component: "Database", aspect: "Data Encryption", risk: 5 },
                { component: "Database", aspect: "Access Logging", risk: 5 },
                { component: "Database", aspect: "Backup Security", risk: 4 },
                
                { component: "API Endpoints", aspect: "CSRF Protection", risk: 2 },
                { component: "API Endpoints", aspect: "Rate Limiting", risk: 2 },
                { component: "API Endpoints", aspect: "Input Validation", risk: 2 },
                { component: "API Endpoints", aspect: "Authorization", risk: 3 },
                { component: "API Endpoints", aspect: "Error Handling", risk: 3 },
                
                { component: "Session Mgmt", aspect: "Token Security", risk: 2 },
                { component: "Session Mgmt", aspect: "Timeout Policy", risk: 3 },
                { component: "Session Mgmt", aspect: "Fixation Protection", risk: 4 },
                { component: "Session Mgmt", aspect: "Storage Security", risk: 3 },
                { component: "Session Mgmt", aspect: "Regeneration", risk: 4 },
                
                { component: "Infrastructure", aspect: "Security Headers", risk: 2 },
                { component: "Infrastructure", aspect: "HTTPS Config", risk: 2 },
                { component: "Infrastructure", aspect: "Server Hardening", risk: 4 },
                { component: "Infrastructure", aspect: "Monitoring", risk: 5 },
                { component: "Infrastructure", aspect: "Logging", risk: 5 }
            ];

            const components = [...new Set(data.map(d => d.component))];
            const aspects = [...new Set(data.map(d => d.aspect))];

            const svg = d3.select("#heat-container")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            const x = d3.scaleBand()
                .range([0, width])
                .domain(aspects)
                .padding(0.1);

            const y = d3.scaleBand()
                .range([height, 0])
                .domain(components)
                .padding(0.1);

            const color = d3.scaleSequential()
                .interpolator(d3.interpolateRdYlGn)
                .domain([5, 1]); // Reverse scale (5 = red/bad, 1 = green/good)

            const tooltip = d3.select("body")
                .append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);

            svg.selectAll()
                .data(data)
                .enter()
                .append("rect")
                .attr("x", d => x(d.aspect))
                .attr("y", d => y(d.component))
                .attr("width", x.bandwidth())
                .attr("height", y.bandwidth())
                .style("fill", d => color(d.risk))
                .style("stroke", "white")
                .style("stroke-width", 2)
                .on("mouseover", function(event, d) {
                    const riskLevels = {1: "Secure", 2: "Low Risk", 3: "Medium Risk", 4: "High Risk", 5: "Critical"};
                    tooltip.transition()
                        .duration(200)
                        .style("opacity", .9);
                    tooltip.html(`<strong>${d.component}</strong><br/>${d.aspect}<br/>Risk Level: ${riskLevels[d.risk]}`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function(d) {
                    tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
                });

            // Add X axis
            svg.append("g")
                .attr("transform", `translate(0, ${height})`)
                .call(d3.axisBottom(x))
                .selectAll("text")
                .style("text-anchor", "end")
                .attr("dx", "-.8em")
                .attr("dy", ".15em")
                .attr("transform", "rotate(-45)");

            // Add Y axis
            svg.append("g")
                .call(d3.axisLeft(y));

            // Add title
            svg.append("text")
                .attr("x", width / 2)
                .attr("y", -20)
                .attr("text-anchor", "middle")
                .style("font-size", "16px")
                .style("font-weight", "bold")
                .text("Security Risk Heat Map by Component and Aspect");
        }

        // Initialize visualizations
        document.addEventListener('DOMContentLoaded', function() {
            createBubbleMap();
            createHeatMap();
        });
    </script>
</body>
</html>